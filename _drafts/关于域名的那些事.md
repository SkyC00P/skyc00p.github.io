
* content
{:toc}

在用Jekyll搭建自己的博客的时候，需要用自己的域名`skycoop.net`。虽然早已过期，但是又重新注册了，过程挺蛋疼的，各种审核以及各种等待无响应(说得就是你，阿里云)。在Github上配置自己的域名还是挺简单的，只要新建一个`CNAME`, 里面写上域名即可，良心Github连这个都省了，一键配置。剩下的就是在域名提供商里配置映射就行。而我就在这过程中，对这个`CNAME`, 映射配置怎么来，产生了点兴趣。





网站域名解析，其实就是DNS。引用阿里云云解析DNS的新手指导说明

> 云解析DNS就是指把网站域名或应用资源转换为数字 IP地址，从而将最终用户的访问路由到相应的网站或应用资源上

看看一个域名要能被映射到具体的地址上是要做哪些配置，这里我盗下阿里云的图啊

![](https://i.imgur.com/S40lUYJ.png)

这一条记录的依据是什么？我掏出了我的《计算机网络》，翻到了第474页。

> 无论是只有一台主机的域还是顶级域，每个域都有一组与它相关联的资源记录。这些记录组成了DNS数据库。当解析器把一个域名传递给DNS时，它能获得的DNS返回结果就是与该域名相关联的资源记录。因此，DNS的基本功能是将域名映射到资源记录。

嗯。看起来就是我要向阿里提供一条记录让他能够插入到他的DNS数据库里去。好吧。那数据结构是什么样的？

> 一条资源记录是一个五元组。尽管出于效率考虑资源记录被编码成了二进制的形式，但是大多数说明性资料还是用ASCII文本来表示资源记录，每一条记录占一行。如下格式

> Domain_name Time_to_live Class Type Vaule

**Domain_name(域名)** 指出了这条记录适用于哪个域。

**Time_to_live(生存期)** 指明了该条记录的稳定程度。这个跟DNS的缓存机制有关了。

**Class(类别)** 对于Internet信息，它总是**IN**，对于非 Internet 信息，则可以使用其他的代码，但实际上很少见。

**Type(类型)** 指出了这是什么类型的记录。

有什么类型，书上是这么写的, 但是这只是一部分，更全的肯定是去看标准了 https://www.iana.org/assignments/dns-parameters/dns-parameters.xhtml。

|类型 | 含义 | （**Vaule**）值 |
|- | :- | :- |
|SOA | 授权开始| 本区域的参数 |
|A | 主机的IPv4地址 | 32位整数 |
|AAAA | 主机的IPv6地址 | 128位整数 |
|MX | 邮件交换 | 优先级，愿意接受邮件的域 |
|NS | 域名服务器 | 本域的服务器名字 |
|CNAME| 规范名 | 域名 | 
| PTR | 指针 | IP 地址的别名|
|SPF | 发送者的政策框架 | 邮件发送政策的文本编码|
| SRV| 服务 | 提供服务的主机|
| TXT| 文本 | 说明的ASCII文本|

好的。那一条资源记录和上面的图的对应关系又是什么呢？依我自己的理解啊，其对应关系应该如下表

| Domain_name(域名)| 主机记录 |
|- |- |
|Time_to_live(生存期) | TTL |
|Type(类型) | 主机类型|
|Vaule | 记录值 |

查了阿里云的帮助文档，差不多。

![](https://i.imgur.com/dzEas9R.png)

阿里云的帮助文档解释了部分DNS类型，https://help.aliyun.com/document_detail/29805.html?spm=a2c4g.11186623.2.4.76XwMs，
也有文档解释了应用场景 https://help.aliyun.com/document_detail/29725.html?spm=a2c4g.11186623.2.5.FiNI6r

这里的域名解析我的配置项为

|记录类型	| 主机记录（RR值）| 线路	|记录值	|	TTL
|- | :- | :- | - | - |
|CNAME	|www	|默认|	skyc00p.github.io|600|
|CNAME	|@	|默认|	skyc00p.github.io|600|
|A	|@	|默认|	192.30.252.153		|600|
|A	|@	|默认|	192.30.252.154		|600|

如何清除本地的DNS缓存以及查看本地的DNS缓存
> 清空dns缓存命令：`ipconfig/flushdns`
> `ipconfig /displaydns`命令，查看当前的DNS缓存信息。

在Windows cmd 下直接Ping我的域名`skycoop.net`,返回的IP地址为

````
正在 Ping sni.github.map.fastly.net [185.199.110.153] 具有 32 字节的数据:
````

不同的是Ping `www.skycoop.net` 返回的结果不同

````
正在 Ping sni.github.map.fastly.net [185.199.108.153] 具有 32 字节的数据:
````

使用 nslookup

````
C:\Users\XPS>nslookup skycoop.net
服务器:  cache-b.shenzhen.gd.cn
Address:  202.96.134.33

DNS request timed out.
    timeout was 2 seconds.
DNS request timed out.
    timeout was 2 seconds.
非权威应答:
名称:    sni.github.map.fastly.net
Addresses:  185.199.111.153
          185.199.108.153
          185.199.109.153
          185.199.110.153
Aliases:  skycoop.net
          skyc00p.github.io
````

````
C:\Users\XPS>ping github.com

正在 Ping github.com [52.74.223.119] 具有 32 字节的数据:
Control-C
^C
C:\Users\XPS>nslookup 52.74.223.119
服务器:  cache-b.shenzhen.gd.cn
Address:  202.96.134.33

名称:    ec2-52-74-223-119.ap-southeast-1.compute.amazonaws.com
Address:  52.74.223.119
````

````
skycoop@skycoop:~$ dig www.skycoop.net 

; <<>> DiG 9.11.3-1ubuntu1.1-Ubuntu <<>> www.skycoop.net
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 456
;; flags: qr rd ra; QUERY: 1, ANSWER: 6, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;www.skycoop.net.               IN      A

;; ANSWER SECTION:
www.skycoop.net.        600     IN      CNAME   skyc00p.github.io.
skyc00p.github.io.      2692    IN      CNAME   sni.github.map.fastly.net.
sni.github.map.fastly.net. 2372 IN      A       185.199.109.153
sni.github.map.fastly.net. 2372 IN      A       185.199.108.153
sni.github.map.fastly.net. 2372 IN      A       185.199.111.153
sni.github.map.fastly.net. 2372 IN      A       185.199.110.153

;; Query time: 18 msec
;; SERVER: 127.0.0.53#53(127.0.0.53)
;; WHEN: Sun Jul 01 14:59:56 UTC 2018
;; MSG SIZE  rcvd: 175
````